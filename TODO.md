# TODO - Next 10 High-Leverage Actions

> **Last Updated:** December 26, 2025 22:45 UTC
> **Documentation Recency Validated:** December 26, 2025
> **Generated by:** Claude with temporal metacognition

---

## Overview

| # | Action | Confidence | Subtasks | Status |
|---|--------|------------|----------|--------|
| 1 | Session Persistence Validation | 98% | 10 | Pending |
| 2 | Sentry Error Boundary Integration | 95% | 10 | Pending |
| 3 | Keyboard Navigation for Cards | 92% | 12 | Pending |
| 4 | Memoization & Memory Leak Fixes | 90% | 15 | Pending |
| 5 | Unit Tests for Core Hooks | 88% | 18 | Pending |
| 6 | Input Validation with Zod Schemas | 94% | 12 | Pending |
| 7 | Error Handling Improvements | 87% | 14 | Pending |
| 8 | Edge Function Integration Tests | 85% | 16 | Pending |
| 9 | Reduced Motion Support | 90% | 10 | Pending |
| 10 | API Timeout & Retry Logic | 82% | 12 | Pending |

---

## Action 1: Session Persistence Validation

**Confidence: 98%** | **Priority: CRITICAL** | **Effort: Medium**

### Problem
`JSON.parse(savedSession)` in `useSessionPersistence.ts:145` parses untrusted localStorage data without schema validation. Malicious session data could corrupt application state.

### Research Citations
- [Zod localStorage Security (Medium, 2025)](https://medium.com/@michu2k/validate-data-in-browser-storage-with-zod-be254f465a40)
- [zod-localstorage npm package](https://www.npmjs.com/package/zod-localstorage)
- [Schema Validation with Zod (Turing, 2025)](https://www.turing.com/blog/data-integrity-through-zod-validation)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 1.1 | Create sessionDataSchema with Zod | `src/types/schemas.ts` | 20min |
| 1.2 | Create safeJsonParse utility | `src/lib/utils.ts` | 15min |
| 1.3 | Update useSessionPersistence to use safeParse | `src/hooks/useSessionPersistence.ts` | 30min |
| 1.4 | Add graceful degradation on parse failure | `src/hooks/useSessionPersistence.ts` | 15min |
| 1.5 | Add toast notification on corrupted session | `src/hooks/useSessionPersistence.ts`, `src/hooks/use-toast.ts` | 10min |
| 1.6 | Create unit tests for safeJsonParse | `src/lib/__tests__/utils.test.ts` | 30min |
| 1.7 | Add session data version migration | `src/hooks/useSessionPersistence.ts` | 20min |
| 1.8 | Implement optional localStorage encryption | `src/lib/crypto.ts` | 45min |
| 1.9 | Add session integrity hash verification | `src/hooks/useSessionPersistence.ts`, `src/lib/crypto.ts` | 30min |
| 1.10 | Document session security in CLAUDE.md | `CLAUDE.md` | 10min |

---

## Action 2: Sentry Error Boundary Integration

**Confidence: 95%** | **Priority: HIGH** | **Effort: Low**

### Problem
`ErrorBoundary.componentDidCatch()` only logs to console. Production errors are untracked, preventing incident diagnosis.

### Research Citations
- [Sentry React Error Boundary Docs (Official, 2025)](https://docs.sentry.io/platforms/javascript/guides/react/features/error-boundary/)
- [Advanced Error Tracking in React (Medium, 2025)](https://medium.com/@ignatovich.dm/integrating-sentry-with-react-advanced-error-tracking-and-handling-0f88c2d322c0)
- [Guide to Error Handling in React (Sentry Blog)](https://blog.sentry.io/guide-to-error-and-exception-handling-in-react/)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 2.1 | Import Sentry in error boundary | `src/components/ui/error-boundary.tsx` | 5min |
| 2.2 | Add Sentry.captureException in componentDidCatch | `src/components/ui/error-boundary.tsx` | 10min |
| 2.3 | Add React error info context | `src/components/ui/error-boundary.tsx` | 10min |
| 2.4 | Add user context (userId, plan) to Sentry | `src/components/ui/error-boundary.tsx` | 15min |
| 2.5 | Create error fingerprinting for deduplication | `src/components/ui/error-boundary.tsx` | 15min |
| 2.6 | Add breadcrumbs for last user actions | `src/components/ui/error-boundary.tsx` | 20min |
| 2.7 | Create custom Sentry tags for spec stage | `src/components/ui/error-boundary.tsx` | 10min |
| 2.8 | Add Sentry feedback widget on error | `src/components/ui/error-boundary.tsx` | 20min |
| 2.9 | Create unit tests for error boundary | `src/components/ui/__tests__/error-boundary.test.tsx` | 30min |
| 2.10 | Document error tracking in CLAUDE.md | `CLAUDE.md` | 10min |

---

## Action 3: Keyboard Navigation for Cards

**Confidence: 92%** | **Priority: HIGH** | **Effort: Medium**

### Problem
8 interactive card components use `onClick` without keyboard support. Screen reader and keyboard-only users cannot access core functionality.

### Research Citations
- [ARIAKit at React Advanced 2025 (InfoQ)](https://www.infoq.com/news/2025/12/accessibility-ariakit-react/)
- [WCAG 2.2 Requirements 2025 (Elementor)](https://elementor.com/blog/wcag-2-2/)
- [Keyboard Accessibility in React (freeCodeCamp)](https://www.freecodecamp.org/news/designing-keyboard-accessibility-for-complex-react-experiences/)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 3.1 | Create reusable InteractiveCard wrapper | `src/components/ui/interactive-card.tsx` | 30min |
| 3.2 | Add keyboard handler utility (Enter/Space) | `src/lib/a11y.ts` | 15min |
| 3.3 | Fix SampleSpecGallery card accessibility | `src/components/SampleSpecGallery.tsx` | 20min |
| 3.4 | Fix ExpertCard expand/collapse accessibility | `src/components/ExpertCard.tsx` | 20min |
| 3.5 | Fix TechStackCard selection accessibility | `src/components/TechStackCard.tsx` | 20min |
| 3.6 | Fix ExpandableAgentCard accessibility | `src/components/ExpandableAgentCard.tsx` | 20min |
| 3.7 | Fix MobileHeader agent selection | `src/components/mobile/MobileHeader.tsx` | 15min |
| 3.8 | Fix ChatMessage avatar click | `src/components/chat/ChatMessage.tsx` | 15min |
| 3.9 | Add visible focus indicators (focus-visible) | `src/index.css` | 15min |
| 3.10 | Add aria-pressed for toggle states | `src/components/ExpertCard.tsx`, `src/components/TechStackCard.tsx` | 20min |
| 3.11 | Create a11y Playwright tests | `tests/accessibility-keyboard.spec.ts` | 45min |
| 3.12 | Document a11y patterns in CLAUDE.md | `CLAUDE.md` | 15min |

---

## Action 4: Memoization & Memory Leak Fixes

**Confidence: 90%** | **Priority: HIGH** | **Effort: Medium**

### Problem
AgentCard event listener leak (2-5MB), unmemoized text parsing, ChatMessage re-renders cause performance degradation on mobile.

### Research Citations
- Internal audit findings from parallel exploration agents
- React performance best practices (useMemo, useCallback, React.memo)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 4.1 | Fix AgentCard event listener leak | `src/components/AgentCard.tsx` | 20min |
| 4.2 | Memoize LiveAgentCard text parsing | `src/components/LiveAgentCard.tsx` | 15min |
| 4.3 | Optimize getTagsFromText toLowerCase | `src/components/LiveAgentCard.tsx` | 10min |
| 4.4 | Add React.memo to ChatMessage | `src/components/chat/ChatMessage.tsx` | 10min |
| 4.5 | Memoize ChatMessage callbacks | `src/components/chat/ChatMessage.tsx` | 15min |
| 4.6 | Extract default tech stack to constant | `src/components/SpecOutput.tsx` | 10min |
| 4.7 | Add lazy initialization for techStack | `src/components/SpecOutput.tsx` | 10min |
| 4.8 | Create memoized DialogueEntryItem | `src/components/DialoguePanel.tsx` | 25min |
| 4.9 | Cache scroll viewport with useRef | `src/components/chat/ChatView.tsx` | 15min |
| 4.10 | Add loading="lazy" to avatar images | `src/components/AgentCard.tsx` | 5min |
| 4.11 | Create shared avatar imports module | `src/lib/avatars.ts` | 20min |
| 4.12 | Update AgentCard to use shared avatars | `src/components/AgentCard.tsx`, `src/lib/avatars.ts` | 10min |
| 4.13 | Update ChatMessage to use shared avatars | `src/components/chat/ChatMessage.tsx`, `src/lib/avatars.ts` | 10min |
| 4.14 | Update LiveAgentCard to use shared avatars | `src/components/LiveAgentCard.tsx`, `src/lib/avatars.ts` | 10min |
| 4.15 | Update DialoguePanel to use shared avatars | `src/components/DialoguePanel.tsx`, `src/lib/avatars.ts` | 10min |

---

## Action 5: Unit Tests for Core Hooks

**Confidence: 88%** | **Priority: HIGH** | **Effort: High**

### Problem
Zero unit tests for 9 critical hooks including useSpecFlow (1400+ LOC). Refactoring risks breaking core functionality.

### Research Citations
- Vitest documentation for React Testing Library integration
- Testing best practices for React hooks (2025)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 5.1 | Set up Vitest testing utilities | `src/test/setup.ts`, `vitest.config.ts` | 30min |
| 5.2 | Create Supabase mock utilities | `src/test/mocks/supabase.ts` | 30min |
| 5.3 | Create localStorage mock utilities | `src/test/mocks/storage.ts` | 20min |
| 5.4 | Test useSession reducer actions | `src/hooks/spec-generation/__tests__/use-session.test.ts` | 45min |
| 5.5 | Test useDialogue reducer actions | `src/hooks/spec-generation/__tests__/use-dialogue.test.ts` | 30min |
| 5.6 | Test useTasks reducer actions | `src/hooks/spec-generation/__tests__/use-tasks.test.ts` | 30min |
| 5.7 | Test useSpecFlow stage transitions | `src/hooks/spec-generation/__tests__/use-spec-flow.test.ts` | 60min |
| 5.8 | Test useSpecFlow error handling | `src/hooks/spec-generation/__tests__/use-spec-flow.test.ts` | 45min |
| 5.9 | Test useSpecFlow pause/resume | `src/hooks/spec-generation/__tests__/use-spec-flow.test.ts` | 30min |
| 5.10 | Test useSessionPersistence debounce | `src/hooks/__tests__/useSessionPersistence.test.ts` | 45min |
| 5.11 | Test useSessionPersistence quota | `src/hooks/__tests__/useSessionPersistence.test.ts` | 30min |
| 5.12 | Test useSessionPersistence expiry | `src/hooks/__tests__/useSessionPersistence.test.ts` | 30min |
| 5.13 | Test useAuth state management | `src/hooks/__tests__/useAuth.test.ts` | 45min |
| 5.14 | Test useAuth session refresh | `src/hooks/__tests__/useAuth.test.ts` | 30min |
| 5.15 | Test useProfile fetching | `src/hooks/__tests__/use-profile.test.ts` | 30min |
| 5.16 | Test useProfile upgrade flow | `src/hooks/__tests__/use-profile.test.ts` | 30min |
| 5.17 | Test use-toast memory management | `src/hooks/__tests__/use-toast.test.ts` | 20min |
| 5.18 | Add CI workflow for unit tests | `.github/workflows/test.yml` | 20min |

---

## Action 6: Input Validation with Zod Schemas

**Confidence: 94%** | **Priority: HIGH** | **Effort: Medium**

### Problem
User inputs passed to Edge Functions without client-side Zod validation. XSS risks in URL construction. Chat has no length limits.

### Research Citations
- [Zod GitHub Documentation (Official)](https://github.com/colinhacks/zod)
- [Schema Validation with Zod (Turing, 2025)](https://www.turing.com/blog/data-integrity-through-zod-validation)

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 6.1 | Create comprehensive input schemas | `src/types/schemas.ts` | 30min |
| 6.2 | Add userInput schema (25-5000 chars) | `src/types/schemas.ts` | 10min |
| 6.3 | Add chatMessage schema (1-2000 chars) | `src/types/schemas.ts` | 10min |
| 6.4 | Add URL validation schema | `src/types/schemas.ts` | 15min |
| 6.5 | Validate input in api.ts before invoke | `src/lib/api.ts`, `src/types/schemas.ts` | 20min |
| 6.6 | Add URL validation to TechStackCard | `src/components/TechStackCard.tsx` | 20min |
| 6.7 | Add domain whitelist for tech logos | `src/components/TechStackCard.tsx` | 15min |
| 6.8 | Add chat input validation in ChatInput | `src/components/chat/ChatInput.tsx` | 15min |
| 6.9 | Add validation error UI feedback | `src/components/SimpleSpecInput.tsx` | 20min |
| 6.10 | Create validation error toast utility | `src/lib/validation.ts` | 15min |
| 6.11 | Test schema edge cases | `src/types/__tests__/schemas.test.ts` | 30min |
| 6.12 | Document validation in CLAUDE.md | `CLAUDE.md` | 10min |

---

## Action 7: Error Handling Improvements

**Confidence: 87%** | **Priority: MEDIUM** | **Effort: Medium**

### Problem
FileReader errors unhandled, canvas.toBlob silent failures, empty catch blocks, missing partial failure notifications.

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 7.1 | Add FileReader error handling in SpecInput | `src/components/SpecInput.tsx` | 20min |
| 7.2 | Add FileReader error handling in SimpleSpecInput | `src/components/SimpleSpecInput.tsx` | 20min |
| 7.3 | Add canvas render error handling | `src/components/SpecOutput.tsx` | 25min |
| 7.4 | Add blob validation before download | `src/components/SpecOutput.tsx` | 15min |
| 7.5 | Replace empty catch with error logging | `src/hooks/useSessionPersistence.ts` | 15min |
| 7.6 | Add partial failure notification | `src/hooks/spec-generation/use-spec-flow.ts` | 25min |
| 7.7 | Track failure rate in parallel executor | `supabase/functions/lib/parallel-executor.ts` | 20min |
| 7.8 | Add getSession error handling | `src/hooks/useAuth.ts` | 15min |
| 7.9 | Add await to fetchProfile after upgrade | `src/hooks/use-profile.ts` | 10min |
| 7.10 | Improve SpecView error messages | `src/pages/SpecView.tsx` | 15min |
| 7.11 | Add response.json() error handling | `supabase/functions/voice-to-text/index.ts` | 15min |
| 7.12 | Add req.json() error handling | `supabase/functions/multi-agent-spec/index.ts` | 15min |
| 7.13 | Create error categorization utility | `src/lib/errors.ts` | 25min |
| 7.14 | Test error scenarios | `tests/error-handling.spec.ts` | 45min |

---

## Action 8: Edge Function Integration Tests

**Confidence: 85%** | **Priority: HIGH** | **Effort: High**

### Problem
No tests for 8-stage multi-agent-spec pipeline or payment flow. Bugs cause revenue loss.

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 8.1 | Create Deno test configuration | `supabase/functions/deno.json` | 20min |
| 8.2 | Create mock LLM responses | `supabase/functions/tests/mocks/llm.ts` | 30min |
| 8.3 | Create mock Supabase client | `supabase/functions/tests/mocks/supabase.ts` | 30min |
| 8.4 | Test questions stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.5 | Test research stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.6 | Test challenge stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.7 | Test synthesis stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.8 | Test review stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.9 | Test voting stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.10 | Test spec stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.11 | Test chat stage | `supabase/functions/tests/multi-agent-spec.test.ts` | 30min |
| 8.12 | Test rate limiting | `supabase/functions/tests/multi-agent-spec.test.ts` | 20min |
| 8.13 | Test voice-to-text validation | `supabase/functions/tests/voice-to-text.test.ts` | 30min |
| 8.14 | Test voice-to-text errors | `supabase/functions/tests/voice-to-text.test.ts` | 25min |
| 8.15 | Test upgrade-to-pro flow | `supabase/functions/tests/upgrade-to-pro.test.ts` | 30min |
| 8.16 | Add edge function tests to CI | `.github/workflows/test.yml` | 20min |

---

## Action 9: Reduced Motion Support

**Confidence: 90%** | **Priority: MEDIUM** | **Effort: Low**

### Problem
AgentCard 3D tilt and Framer Motion animations don't respect `prefers-reduced-motion`. Users with vestibular disorders affected.

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 9.1 | Create useReducedMotion hook | `src/hooks/use-reduced-motion.ts` | 15min |
| 9.2 | Disable AgentCard tilt on reduced motion | `src/components/AgentCard.tsx` | 15min |
| 9.3 | Create motion-safe variants for Framer | `src/lib/motion.ts` | 25min |
| 9.4 | Update DialoguePanel animations | `src/components/DialoguePanel.tsx` | 15min |
| 9.5 | Update ChatView animations | `src/components/chat/ChatView.tsx` | 15min |
| 9.6 | Update LiveAgentCard animations | `src/components/LiveAgentCard.tsx` | 15min |
| 9.7 | Add CSS reduced motion fallbacks | `src/index.css` | 15min |
| 9.8 | Test with reduced motion enabled | `tests/accessibility-motion.spec.ts` | 30min |
| 9.9 | Document motion preferences | `CLAUDE.md` | 10min |
| 9.10 | Plan settings toggle (future) | `docs/ROADMAP.md` | 10min |

---

## Action 10: API Timeout & Retry Logic

**Confidence: 82%** | **Priority: MEDIUM** | **Effort: Medium**

### Problem
AbortController timeout doesn't work with Supabase client. 35-minute operations can hang indefinitely.

### Alternative Approach (18% consideration)
Use TanStack Query's built-in retry with exponential backoff instead of custom implementation.

### Atomic Subtasks

| # | Task | Files (≤5) | Est. |
|---|------|------------|------|
| 10.1 | Verify Supabase signal support | `src/lib/api.ts` | 15min |
| 10.2 | Implement manual timeout wrapper | `src/lib/api.ts` | 30min |
| 10.3 | Add timeout error differentiation | `src/lib/api.ts` | 15min |
| 10.4 | Create retry utility with backoff | `src/lib/retry.ts` | 30min |
| 10.5 | Add retry for transient failures | `src/lib/api.ts`, `src/lib/retry.ts` | 25min |
| 10.6 | Add timeout progress indicator | `src/components/ProcessViewer.tsx` | 25min |
| 10.7 | Add cancel button for long operations | `src/components/ProcessViewer.tsx` | 30min |
| 10.8 | Implement request cancellation | `src/hooks/spec-generation/use-spec-flow.ts` | 35min |
| 10.9 | Add offline detection | `src/lib/network.ts` | 20min |
| 10.10 | Show offline banner | `src/App.tsx`, `src/lib/network.ts` | 25min |
| 10.11 | Test timeout scenarios | `tests/api-timeout.spec.ts` | 45min |
| 10.12 | Document timeout behavior | `CLAUDE.md` | 10min |

---

## Implementation Timeline

### Week 1 (Critical Security & Observability)
- [ ] Action 1: Session Persistence Validation
- [ ] Action 2: Sentry Error Boundary Integration

### Week 2 (Accessibility & Performance)
- [ ] Action 3: Keyboard Navigation for Cards
- [ ] Action 4: Memoization & Memory Leak Fixes

### Week 3 (Security & Resilience)
- [ ] Action 6: Input Validation with Zod
- [ ] Action 7: Error Handling Improvements

### Week 4 (Testing Foundation)
- [ ] Action 5: Unit Tests for Core Hooks
- [ ] Action 8: Edge Function Integration Tests

### Week 5 (Polish)
- [ ] Action 9: Reduced Motion Support
- [ ] Action 10: API Timeout & Retry Logic

---

## Documentation Recency Validation

| Document | Last Updated | Status |
|----------|--------------|--------|
| README.md | Dec 26, 2025 | ✅ Current |
| CLAUDE.md | Dec 26, 2025 | ✅ Current |
| CHANGELOG.md | Dec 23, 2025 | ⚠️ Needs update |
| package.json | Dec 26, 2025 | ✅ Current |

### External Documentation Validated
- [Sentry React Docs](https://docs.sentry.io/platforms/javascript/guides/react/) - ✅ Current (2025)
- [Zod GitHub](https://github.com/colinhacks/zod) - ✅ Current (v3.25)
- [WCAG 2.2 Guidelines](https://www.w3.org/TR/WCAG22/) - ✅ Current (2025)
- [ARIAKit](https://ariakit.org/) - ✅ Current (React Advanced 2025)

---

*This TODO.md is auto-regenerated at each turn per CLAUDE.md requirements.*
